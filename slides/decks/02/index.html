<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Lesson 02</title>

		<link rel="stylesheet" href="../../dist/reset.css">
		<link rel="stylesheet" href="../../dist/reveal.css">
		<link rel="stylesheet" href="../../dist/theme/black.css">
		<link rel="stylesheet" type="text/css" href="../../css/asciinema-player.css" />

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="../../plugin/highlight/github-dark.css">
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section id="introduction">
					<h1>Docker</h1>
					<h3>Lesson 02</h3>
					<h4>SW4BED-01</h4>
				</section>
				<section id="agenda">
					<h2>Agenda</h2>
					<ul>
						<li>What is Docker?</li>
						<li>Build and deploy containers</li>
						<li>Creating images</li>
						<li>Persisting data</li>
						<li>Multi-container applications</li>
					</ul>
				</section>
				<section id="what-is-docker">
					<section>
						<h1>What is Docker?</h1>
					</section>
					<section>
						<h2>Overview</h2>
						<ul>
							<li>Docker is an open platform for developing, shipping and running applications</li>
							<li>Docker <mark>separates</mark> applications from <mark>infrastructure</mark></li>
							<li>Docker let you manage your <mark>infrastructure</mark> in the same way you manage your applications</li>
						</ul>
						<aside class="notes" aria-label="notes">
							<h4>References</h4>
							<ul>
								<li>Docker overview | Docker Documentation</li>
							</ul>
						</aside>
					</section>
					<section>
						<h2>Docker architecture</h2>
						<ul>
							<li>Docker <mark>daemon</mark>
								<ul>
									<li>listens for Docker API requests</li>
									<li>Manages Docker objects</li>
								</ul>
							</li>
							<li>Docker <mark>client</mark>
								<ul>
									<li>The primary way users interact with Docker</li>
								</ul>
							</li>
							<li>Docker <mark>registries</mark>
								<ul>
									<li>Stores Docker images</li>
									<li>Docker Hub is a public registry (used by default). You can run a private registry</li>
									<li><code>docker pull/run</code> fetches required images, and <code>docker push</code> publishes images to registries</li>
								</ul>
							</li>
						</ul>
						<aside class="notes">
							<h4>References</h4>
							<ul>
								<li><a href="https://docs.docker.com/get-started/overview/">Docker overview | Docker Documentation</a></li>
							</ul>
						</aside>
					</section>
					<section>
						<h2>Docker architecture</h2>
						<img src="../../assets/docker-architecture.svg" alt="docker-architecture" width="50%" />
						<aside class="notes">
							<h4>References</h4>
							<ul>
								<li><a href="https://docs.docker.com/get-started/overview/#docker-architecture">Docker overview | Docker Documentation</a></li>
							</ul>
						</aside>
					</section>
					<section>
						<h2>Docker images</h2>
						<ul>
							<li>Images are <mark>read-only</mark> templates with instructions for creating containers
								<ul>
									<li>Images are typically based on other images, with some customization</li>
								</ul>
							</li>
							<li>To build an image, you create a <mark>Dockerfile</mark>
								<ul>
									<li>A simple syntax defines the steps needed to produce and image and run it</li>
									<li>Each instruction create a layer in the image</li>
								</ul>
							</li>
							<li><mark>Layers</mark> are what makes Docker so lightweight, small, and fast when compared with other virtualization technologies
								<ul>
									<li>When rebuilding an image, only those layers which have changed are rebuilt</li>
								</ul>
							</li>
						</ul>
					</section>
					<section>
						<h2>Docker containers</h2>
						<ul>
							<li>A container is a <mark>runnable instance</mark> of an image</li>
							<li>A container is relatively well <mark>isolated</mark> from other containers and its host machine</li>
							<li>A container is defined by its image as well as any <mark>configuration</mark> you provide to it when you create or start it
								<ul>
								<li>When a container is removed, any changes to its state that are not stored in persistent storage disappear</li>
								</ul>
							</li>
						</ul>
					</section>
				</section>
				<section id="creating-images">
					<section>
						<h1>Creating images</h1>
					</section>
					<section>
						<h2>Overview</h2>
						<ul>
							<li>Dockerfiles</li>
							<li>Building images
								<ul>
									<li>Using <code>docker build</code></li>
									<li>Multi-stage builds</li>
								</ul>
							</li>
						</ul>
					</section>
					<section>
						<h2>Dockerfile</h2>
						<pre><code class="docker" data-line-numbers data-trim data-noescape><script type="text/template">
							# https://hub.docker.com/_/microsoft-dotnet
							FROM mcr.microsoft.com/dotnet/sdk:6.0 AS build
							WORKDIR /source
							
							# copy csproj and restore as distinct layers
							COPY *.sln .
							COPY whales/*.csproj ./whales/
							RUN dotnet restore
							
							# copy everything else and build app
							COPY whales/. ./whales
							WORKDIR /source/whales
							RUN dotnet publish -c release -o /app
							
							# final stage/image
							FROM mcr.microsoft.com/dotnet/aspnet:6.0
							WORKDIR /app
							COPY --from=build /app ./
							ENTRYPOINT ["dotnet", "whales.dll"]
						</script>
						</code></pre>
						<small>examples/lesson-02-docker/hello-docker/Dockerfile</small>
					</section>
					<section>
						<h2>Docker build</h2>
						<ul>
							<li>The <code>docker build</code> command builds an image from a Dockerfile and a context
								<ul>
									<li>A build's context is a set of files located in a <code>PATH</code> or <code>URL</code></li>
									<li>When the <code>URL</code> points to a Git repository, that acts as the context </li>
								</ul>
							</li>
							<li>Options
								<ul>
									<li><code>--pull</code>—Always attempt to pull a newer version of the image</li>
									<li><code>--file, -f</code>—Name of the Dockerfile (Default is 'PATH/Dockerfile')</li>
									<li><code>--tag , -t</code>—Name and optionally a tag in the 'name:tag' format</li>
								</ul>
							</li>
							<li>Use a <code>.dockerignore</code> file to exclude files from being sent to the Docker daemon</li>
						</ul>
						<aside class="notes" aria-label="notes">
							<h4>References</h4>
							<ul>
								<li><a href="https://docs.docker.com/engine/reference/commandline/build/">docker build | Docker Documentation</a></li>
							</ul>
						</aside>
					</section>
				</section>
				<section id="build-and-deploy-containers">
					<section>
						<h1>Build and deploy containers</h1>
					</section>
				</section>
				<section id="persisting-data">
					<section>
						<h1>Persisting data</h1>
					</section>
					<section>
						<h2>Overview</h2>
						<ul>
							<li>Data does not persist when a container no longer exists</li>
							<li>Docker has two options for containers to store files in the host machine
								<ul>
									<li>Volumes</li>
									<li>Bind mounts</li>
									<li><code>tmpfs</code> (Linux) or <code>named pipes</code> (Windows)</li>
								</ul>
							</li>
						</ul>
						<aside class="notes" aria-label="notes">
							<h4>References</h4>
							<ul>
								<li><a href="https://docs.docker.com/storage/">Manage data in Docker | Docker Documentation</a></li>
							</ul>
						</aside>
					</section>
				</section>
				<section id="multi-container-applications">
					<section>
						<h1>Multi-container applications</h1>
					</section>
				</section>
				<section>
					<h2>Wrap-up</h2>
					<ul>
						<li>What is Docker?</li>
						<li>Build and deploy containers</li>
						<li>Creating images</li>
						<li>Persisting data</li>
						<li>Multi-container applications</li>
					</ul>
				</section>
			</div>
		</div>

		<script src="../../dist/reveal.js"></script>
		<script src="../../plugin/notes/notes.js"></script>
		<script src="../../plugin/markdown/markdown.js"></script>
		<script src="../../plugin/highlight/highlight.js"></script>
		<script src="../../js/asciinema-player.js"></script>

		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,
				slideNumber: true,
				pdfSeparateFragments: false,
				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
		</script>
	</body>
</html>
